<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Code Reference</title>

  <style>
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      margin: 24px;
      background: #fff;
      color: #111;
    }
    .container {
      max-width: 1100px;
      margin: 0 auto;
    }
    h1, h2 {
      margin-top: 32px;
    }
    ul {
      margin-top: 8px;
    }
    li {
      margin-bottom: 10px;
    }
    code {
      background: #f6f8fa;
      padding: 2px 6px;
      border-radius: 6px;
    }
    .section {
      margin-top: 36px;
      padding-top: 12px;
      border-top: 1px solid #e5e7eb;
    }
    a {
      text-decoration: none;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>Code Reference</h1>

    <p>
      This directory contains the <strong>control-plane implementation</strong>
      for a governed, multi-tenant agent runtime.
    </p>

    <p>
      Files are organized by <em>system responsibility</em>, not by framework
      or abstraction layer.
    </p>

    <!-- API -->
    <div class="section">
      <h2>API ingress</h2>
      <ul>
        <li>
          <strong><a href="https://github.com/RajaRangiah/multi-tenant-agent-control-plane/blob/main/code/api_server.py">api_server.py</a></strong><br />
          Durable job submission endpoint.
          Performs budget checks, initializes job state, and enqueues work
          into Redis Streams atomically.
        </li>
      </ul>
    </div>

    <!-- Atomic state -->
    <div class="section">
      <h2>Atomic state transitions (Redis + Lua)</h2>
      <ul>
        <li>
          <strong><a href="https://github.com/RajaRangiah/multi-tenant-agent-control-plane/blob/main/code/lua_ops.py">lua_ops.py</a></strong><br />
          Defines atomic <code>CLAIM</code>, <code>RENEW</code>, and
          <code>FINALIZE</code> operations.
          Enforces quota charging, lease ownership, and idempotent completion.
        </li>

        <li>
          <strong><a href="https://github.com/RajaRangiah/multi-tenant-agent-control-plane/blob/main/code/redis_schema.py">redis_schema.py</a></strong><br />
          Canonical Redis key schema for job state, leases, quotas, and observability.
        </li>
      </ul>
    </div>

    <!-- Scheduling -->
    <div class="section">
      <h2>Scheduling & backoff</h2>
      <ul>
        <li>
          <strong><a href="https://github.com/RajaRangiah/multi-tenant-agent-control-plane/blob/main/code/delayed_scheduler.py">delayed_scheduler.py</a></strong><br />
          Moves jobs from delayed queues back into execution streams
          after backoff or budget replenishment.
        </li>
      </ul>
    </div>

    <!-- Crash recovery -->
    <div class="section">
      <h2>Crash recovery</h2>
      <ul>
        <li>
          <strong><a href="https://github.com/RajaRangiah/multi-tenant-agent-control-plane/blob/main/code/pel_reaper.py">pel_reaper.py</a></strong><br />
          Periodically scans Redis Stream PELs to recover jobs
          abandoned by crashed workers.
        </li>
      </ul>
    </div>

    <!-- Worker -->
    <div class="section">
      <h2>Worker execution discipline</h2>
      <ul>
        <li>
          <strong><a href="https://github.com/RajaRangiah/multi-tenant-agent-control-plane/blob/main/code/worker.py">worker.py</a></strong><br />
          Stateless executor.
          Pulls jobs, claims leases, renews ownership while running,
          and finalizes execution deterministically.
        </li>
      </ul>
    </div>

    <div class="section">
      <p style="font-style: italic;">
        Workers contain no durable state. All safety and correctness
        live in the control plane.
      </p>
    </div>
  </div>
</body>
</html>
